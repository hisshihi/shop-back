import{_ as R,u as I,r as m,p as $,A as z,g as F,c as a,a as e,i as S,s as V,x as U,y as j,t as c,n as x,b as y,f as A,w as p,v as w,B as k,o as t}from"./index-Bb9AnJlj.js";const G={class:"account-page"},H={class:"container"},J={key:0,class:"loading-container"},K={key:1,class:"error-container"},O={key:2,class:"account-container"},Q={class:"account-sidebar"},W={class:"user-info"},X={class:"user-avatar"},Y={class:"user-name"},Z={class:"account-navigation"},ss={class:"account-content"},es={key:0,class:"profile-container"},ls={class:"section-header"},as={key:0,class:"profile-details"},ts={class:"detail-item"},os={class:"detail-value"},ns={class:"detail-item"},us={class:"detail-value"},rs={class:"detail-item"},is={class:"detail-value"},ds={class:"detail-item"},vs={class:"detail-value"},ms={class:"detail-item"},cs={class:"detail-value"},fs={class:"form-group"},ps={class:"form-group"},ws={class:"form-group"},bs={class:"form-group"},ys={class:"form-group"},_s={key:0,class:"error-message"},gs={key:1,class:"success-message"},Ps={class:"form-actions"},ks=["disabled"],hs={key:0},Cs={key:1},Vs=["disabled"],Us={key:1,class:"security-container"},xs={class:"section-header"},qs={key:0,class:"security-info"},Ds={class:"form-group"},Es={class:"form-group"},Ms={class:"form-group"},Ss={key:0,class:"error-message"},As={key:1,class:"success-message"},Bs={class:"form-actions"},Ts=["disabled"],Ls={key:0},Ns={key:1},Rs=["disabled"],Is={__name:"AccountView",setup($s){const l=I(),B=z(),r=m(!1),g=m("profile"),_=m(!1),o=m({username:"",email:"",fullname:"",phone:"",password:""}),b=m(!1),u=m({oldPassword:"",newPassword:"",confirmPassword:""}),h=m(!1),i=m(null),P=m(!1),d=m(null);$(async()=>{if(!l.isAuthenticated){B.push("/login");return}r.value=!0;try{await l.fetchUserData(),q()}catch(v){console.error("Ошибка при загрузке данных пользователя:",v)}finally{r.value=!1}});function q(){l.user&&(o.value={username:l.user.username||"",email:l.user.email||"",fullname:l.user.fullname||"",phone:l.user.phone||"",password:""})}const f=F(()=>l.user?{username:l.user.username||"Не указано",email:l.user.email||"Не указано",fullname:l.user.fullname||"Не указано",phone:l.user.phone||"Не указано",role:l.user.role==="admin"?"Администратор":"Пользователь",status:l.user.isBanned?"Заблокирован":"Активен"}:null);function D(v){g.value=v,_.value=!1,b.value=!1,h.value=!1,P.value=!1,i.value=null,d.value=null}function E(){_.value=!_.value,_.value?q():(i.value=null,h.value=!1)}function M(){b.value=!b.value,b.value||(u.value={oldPassword:"",newPassword:"",confirmPassword:""},d.value=null,P.value=!1)}async function T(){if(!o.value.username.trim()){i.value="Логин обязателен";return}if(!o.value.email.trim()){i.value="Email обязателен";return}if(!o.value.fullname.trim()){i.value="Имя обязательно";return}if(!o.value.phone.trim()){i.value="Телефон обязателен";return}if(!o.value.password.trim()){i.value="Пароль обязателен для подтверждения изменений";return}if(confirm("После изменения данных профиля будет необходимо повторно войти в систему. Продолжить?")){i.value=null,r.value=!0;try{const s=await l.updateUserData(o.value);s.success?(h.value=!0,o.value.password="",alert("Данные успешно обновлены. Сейчас вы будете перенаправлены на страницу входа."),setTimeout(()=>{l.logout()},1500)):i.value=s.error||"Не удалось обновить данные профиля"}catch(s){console.error("Ошибка при обновлении профиля:",s),i.value="Произошла непредвиденная ошибка"}finally{r.value=!1}}}async function L(){if(!u.value.oldPassword.trim()){d.value="Текущий пароль обязателен";return}if(!u.value.newPassword.trim()){d.value="Новый пароль обязателен";return}if(u.value.newPassword.length<6){d.value="Новый пароль должен содержать минимум 6 символов";return}if(u.value.newPassword!==u.value.confirmPassword){d.value="Пароли не совпадают";return}d.value=null,r.value=!0;try{const v=await l.changePassword(u.value.oldPassword,u.value.newPassword);v.success?(P.value=!0,u.value={oldPassword:"",newPassword:"",confirmPassword:""},setTimeout(()=>{b.value=!1,P.value=!1},2e3)):d.value=v.error||"Не удалось изменить пароль"}catch(v){console.error("Ошибка при смене пароля:",v),d.value="Произошла непредвиденная ошибка"}finally{r.value=!1}}function N(){l.logout()}return(v,s)=>{const C=j("RouterLink");return t(),a("div",G,[e("div",H,[s[33]||(s[33]=e("h1",{class:"page-title"},"Личный кабинет",-1)),r.value?(t(),a("div",J,s[10]||(s[10]=[e("div",{class:"loading-spinner"},null,-1),e("p",null,"Загрузка данных...",-1)]))):S(l).user?(t(),a("div",O,[e("div",Q,[e("div",W,[e("div",X,c(f.value.username.charAt(0).toUpperCase()),1),e("div",Y,c(f.value.fullname),1),e("div",{class:x(["user-status",{"user-banned":S(l).user.IsBanned}])},c(f.value.status),3)]),e("nav",Z,[e("button",{onClick:s[0]||(s[0]=n=>D("profile")),class:x(["nav-item",{active:g.value==="profile"}])}," Профиль ",2),e("button",{onClick:s[1]||(s[1]=n=>D("security")),class:x(["nav-item",{active:g.value==="security"}])}," Безопасность ",2),V(C,{to:"/orders",class:"nav-item"},{default:U(()=>s[13]||(s[13]=[k(" Мои заказы ")])),_:1}),V(C,{to:"/favorites",class:"nav-item"},{default:U(()=>s[14]||(s[14]=[k(" Избранное ")])),_:1}),V(C,{to:"/cart",class:"nav-item"},{default:U(()=>s[15]||(s[15]=[k(" Корзина ")])),_:1}),e("button",{onClick:N,class:"nav-item logout-btn"}," Выйти из аккаунта ")])]),e("div",ss,[g.value==="profile"?(t(),a("div",es,[e("div",ls,[s[16]||(s[16]=e("h2",{class:"section-title"},"Данные профиля",-1)),_.value?y("",!0):(t(),a("button",{key:0,onClick:E,class:"btn btn-outline edit-btn"}," Редактировать "))]),_.value?(t(),a("form",{key:1,class:"profile-form",onSubmit:A(T,["prevent"])},[e("div",fs,[s[22]||(s[22]=e("label",{for:"username",class:"form-label"},"Логин:",-1)),p(e("input",{type:"text",id:"username","onUpdate:modelValue":s[2]||(s[2]=n=>o.value.username=n),class:"form-input",required:""},null,512),[[w,o.value.username]])]),e("div",ps,[s[23]||(s[23]=e("label",{for:"email",class:"form-label"},"Email:",-1)),p(e("input",{type:"email",id:"email","onUpdate:modelValue":s[3]||(s[3]=n=>o.value.email=n),class:"form-input",required:""},null,512),[[w,o.value.email]])]),e("div",ws,[s[24]||(s[24]=e("label",{for:"fullname",class:"form-label"},"Полное имя:",-1)),p(e("input",{type:"text",id:"fullname","onUpdate:modelValue":s[4]||(s[4]=n=>o.value.fullname=n),class:"form-input",required:""},null,512),[[w,o.value.fullname]])]),e("div",bs,[s[25]||(s[25]=e("label",{for:"phone",class:"form-label"},"Телефон:",-1)),p(e("input",{type:"tel",id:"phone","onUpdate:modelValue":s[5]||(s[5]=n=>o.value.phone=n),class:"form-input",required:""},null,512),[[w,o.value.phone]])]),e("div",ys,[s[26]||(s[26]=e("label",{for:"password",class:"form-label"},"Пароль для подтверждения:",-1)),p(e("input",{type:"password",id:"password","onUpdate:modelValue":s[6]||(s[6]=n=>o.value.password=n),class:"form-input",required:"",placeholder:"Введите текущий пароль для подтверждения изменений"},null,512),[[w,o.value.password]])]),i.value?(t(),a("div",_s,c(i.value),1)):y("",!0),h.value?(t(),a("div",gs,"Данные успешно обновлены!")):y("",!0),s[27]||(s[27]=e("div",{class:"alert-info"},[e("p",null,"При изменении данных профиля вам потребуется повторно войти в систему.")],-1)),e("div",Ps,[e("button",{type:"submit",class:"btn btn-accent",disabled:r.value},[r.value?(t(),a("span",hs,"Сохранение...")):(t(),a("span",Cs,"Сохранить изменения"))],8,ks),e("button",{type:"button",onClick:E,class:"btn btn-outline",disabled:r.value}," Отмена ",8,Vs)])],32)):(t(),a("div",as,[e("div",ts,[s[17]||(s[17]=e("span",{class:"detail-label"},"Логин:",-1)),e("span",os,c(f.value.username),1)]),e("div",ns,[s[18]||(s[18]=e("span",{class:"detail-label"},"Email:",-1)),e("span",us,c(f.value.email),1)]),e("div",rs,[s[19]||(s[19]=e("span",{class:"detail-label"},"Полное имя:",-1)),e("span",is,c(f.value.fullname),1)]),e("div",ds,[s[20]||(s[20]=e("span",{class:"detail-label"},"Телефон:",-1)),e("span",vs,c(f.value.phone),1)]),e("div",ms,[s[21]||(s[21]=e("span",{class:"detail-label"},"Роль:",-1)),e("span",cs,c(f.value.role),1)])]))])):g.value==="security"?(t(),a("div",Us,[e("div",xs,[s[28]||(s[28]=e("h2",{class:"section-title"},"Безопасность аккаунта",-1)),b.value?y("",!0):(t(),a("button",{key:0,onClick:M,class:"btn btn-outline edit-btn"}," Сменить пароль "))]),b.value?(t(),a("form",{key:1,class:"password-form",onSubmit:A(L,["prevent"])},[e("div",Ds,[s[30]||(s[30]=e("label",{for:"oldPassword",class:"form-label"},"Текущий пароль:",-1)),p(e("input",{type:"password",id:"oldPassword","onUpdate:modelValue":s[7]||(s[7]=n=>u.value.oldPassword=n),class:"form-input",required:""},null,512),[[w,u.value.oldPassword]])]),e("div",Es,[s[31]||(s[31]=e("label",{for:"newPassword",class:"form-label"},"Новый пароль:",-1)),p(e("input",{type:"password",id:"newPassword","onUpdate:modelValue":s[8]||(s[8]=n=>u.value.newPassword=n),class:"form-input",required:"",placeholder:"Минимум 6 символов"},null,512),[[w,u.value.newPassword]])]),e("div",Ms,[s[32]||(s[32]=e("label",{for:"confirmPassword",class:"form-label"},"Подтвердите новый пароль:",-1)),p(e("input",{type:"password",id:"confirmPassword","onUpdate:modelValue":s[9]||(s[9]=n=>u.value.confirmPassword=n),class:"form-input",required:""},null,512),[[w,u.value.confirmPassword]])]),d.value?(t(),a("div",Ss,c(d.value),1)):y("",!0),P.value?(t(),a("div",As,"Пароль успешно изменен!")):y("",!0),e("div",Bs,[e("button",{type:"submit",class:"btn btn-accent",disabled:r.value},[r.value?(t(),a("span",Ls,"Сохранение...")):(t(),a("span",Ns,"Сменить пароль"))],8,Ts),e("button",{type:"button",onClick:M,class:"btn btn-outline",disabled:r.value}," Отмена ",8,Rs)])],32)):(t(),a("div",qs,s[29]||(s[29]=[e("p",null,"Здесь вы можете изменить пароль от вашего аккаунта.",-1),e("p",{class:"security-tip"},[e("span",{class:"tip-icon"},"💡"),k(" Рекомендуется регулярно менять пароль и использовать различные комбинации символов для обеспечения безопасности. ")],-1)])))])):y("",!0)])])):(t(),a("div",K,[s[12]||(s[12]=e("p",null,"Не удалось загрузить данные пользователя. Пожалуйста, войдите снова.",-1)),V(C,{to:"/login",class:"btn btn-primary"},{default:U(()=>s[11]||(s[11]=[k("Войти")])),_:1})]))])])}}},Fs=R(Is,[["__scopeId","data-v-3f682bed"]]);export{Fs as default};
